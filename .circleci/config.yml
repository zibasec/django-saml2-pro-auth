# Python CircleCI 2.0 configuration file
#
# Check https://circleci.com/docs/2.0/language-python/ for more details
#
version: 2
jobs:
  build:
    docker:
      - image: n42org/tox

    working_directory: ~/repo

    steps:
      - checkout
      - run:
          name: Setup Apt deps 
          command: |
            apt-get update
            apt-get -y install build-essential libssl-dev libffi-dev python-dev libxml2-dev libxmlsec1 xmlsec1 libxmlsec1-openssl pkg-config libxmlsec1-dev
            pip install coverage coveralls



  test:
    docker:
      - image: n42org/tox

    working_directory: ~/repo
    parallelism: 4
    steps:
      - run:
          name: 2.7 Tests 
          command: |
            tox -e py27-18,py27-110,py27-111

      - run:
          name: 3.4 Tests 
          command: |
            tox -e py34-18,py34-110,py34-111

      - run:
          name: 3.5 Tests 
          command: |
            tox -e py35-18,py35-110,py35-111

      - run:
          name: 3.6 Tests 
          command: |
            tox -e py36-111

#      - run:
#          name: run coveralls
#          command: |
#            . venv/bin/activate
#            coveralls
#
#      - run:
#          name: run report
#          command: |
#            coverage html -d ./test-reports/ 
#
#      - store_artifacts:
#          path: test-reports
#          destination: test-reports
